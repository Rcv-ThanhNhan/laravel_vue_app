(()=>{var t="/api/user";function n(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,a=$("#searchUser"),i=new FormData(a[0]),s={},r=$("#lstUsers"),o={name:i.get("name"),email:i.get("email"),group:i.get("group"),status:i.get("status")};""==o.name&&""==o.email&&""==o.group&&""==o.status||(n=a.attr("action"),s=o),$.ajax({url:n,method:"get",data:s,beforeSend:function(){r.html('\n                <div class="loading-table">\n                  <div class="spinner-border text-dark" role="status"></div>\n                </div>')}}).done((function(t){t&&(r.html(t.data),e(t.meta))})).fail((function(t){return t.responseJSON}))}function e(t){var n=$(".pagination-container"),e="",a="",i=t;$(i.links).each((function(t,n){(t>i.current_page-3&&t<i.current_page+3||i.current_page===t)&&null!=n.url&&(e+=' <li class="page-item'.concat(n.active?" active":"",'">\n                            <button class="page-link" data-link="').concat(n.url,'" > ').concat(n.label,"</button>\n                        </li>"))}));var s="",r="";i.last_page>3&&(1!==i.current_page&&i.current_page>3&&(s='<li class="page-item"><button class="page-link" data-link="'.concat(t.links[1].url,'" > Trang đầu</button></li>')),i.current_page!==i.last_page&&i.current_page+2<i.last_page&&(r=' <li class="page-item"><button class="page-link"  data-link="'.concat(t.links[t.last_page].url,'" > Trang cuối</button></li>'))),i.last_page>1?a+=' <div class="paginate-style">\n                <nav aria-label="Page navigation example">\n                    <span>Hiển thị '.concat(i.from," đên ").concat(i.to," trên ").concat(i.total,' người dùng</span>\n                    <ul class="pagination justify-content-end">\n                        ').concat(s,"\n                        ").concat(e,"\n                        ").concat(r,"\n                    </ul>\n                </nav>\n            </div>"):a+='<div class="paginate-style"></div>',n.html(a)}function a(t){t.removeClass("was-validated"),$(t).find("input").each((function(){$(this).val("")})),$(t).find("select").prop("selectedIndex",0),t.find('[name="status"]').prop("checked",!1),$(t.find("input.form-control")).each((function(t){$(this).removeClass("is-valid").removeClass("is-invalid")}))}function i(n){var e=t+"/"+n;return $.ajax({url:e,method:"get"}).done((function(t){if(t)return t.data})).fail((function(t){return t.responseJSON}))}$(document).ready((function(){var s;n(),(s=$("#UserEditAddModal").find("form")).submit((function(t){t.preventDefault();var e=$(this).attr("action"),i=$(this).attr("method"),r=$(this).attr("data-type"),o=new FormData(this),l=$(".loading-submit"),c={username:o.get("username"),email:o.get("email"),passwd:o.get("passwd"),passwd_confirm:o.get("passwd_confirm"),group:o.get("group"),is_active:$(this).find('[name="status"]').prop("checked")?1:0};"edit"==r&&(c._method="PATCH",""==c.username||""==c.email||""==c.group||null==c.group)||("add"!=r||""!=c.username&&""!=c.email&&""!=c.passwd&&""!=c.passwd_confirm&&""!=c.group&&null!=c.group)&&$.ajax({url:e,method:i,data:c,cache:!1}).done((function(t){t&&422==t.status?(t.errors.username&&($("#UserEditAddModal").find('[name="username"]').addClass("is-invalid"),$(".invalid-feedback-username").text(t.errors.username)),t.errors.email&&($("#UserEditAddModal").find('[name="email"]').addClass("is-invalid"),$(".invalid-feedback-email").text(t.errors.email)),t.errors.group&&($("#UserEditAddModal").find('[name="group"]').addClass("is-invalid"),$(".invalid-feedback-group").text(t.errors.group)),t.errors.passwd&&($("#UserEditAddModal").find('[name="passwd"]').addClass("is-invalid"),$(".invalid-feedback-passwd").text(t.errors.passwd)),t.errors.passwd_confirm&&($("#UserEditAddModal").find('[name="passwd_confirm"]').addClass("is-invalid"),$(".invalid-feedback-passwd_confirm").text(t.errors.passwd_confirm))):(a(s),Swal.fire({icon:"success",title:t.message,showConfirmButton:!1,timer:1500}),n(),$("#UserEditAddModal").modal("toggle"))})).fail((function(t){200==t.status&&0!=t.status||(l.addClass("d-none"),Swal.fire({icon:"error",title:"Thêm người dùng thất bại",showConfirmButton:!1,timer:1500}))}))})),$("#lstUsers").on("click",".btn-block-user",(function(){var t,e;t=$(this).data("id"),e=Swal.mixin({customClass:{confirmButton:"btn btn-success",cancelButton:"btn btn-danger mr-2"},buttonsStyling:!1}),i(t).then((function(a){if(1==a.data.is_delete)return e.fire({title:"Không tìm thấy người dùng",icon:"error",showCancelButton:!1,confirmButtonText:"Đóng",timer:3e3});a.data?e.fire({title:"Bạn có muốn "+(a.data.is_active?"khóa":"mở khóa")+" tài khoản "+a.data.name,icon:"warning",showCancelButton:!0,confirmButtonText:"Đồng ý",cancelButtonText:"Hủy",reverseButtons:!0}).then((function(e){e.isConfirmed&&$.ajax({url:"/api/user/update-status",method:"post",data:{id:t}}).done((function(t){t&&(Swal.fire({icon:"success",title:t.message,showConfirmButton:!1,timer:1500}),n())})).fail((function(t){return t.responseJSON}))})):e.fire({title:"Không tìm thấy người dùng",icon:"error",showCancelButton:!1,confirmButtonText:"Đóng",timer:3e3})}))})),$("#lstUsers").on("click",".btn-delete-user",(function(){var e,a;e=$(this).attr("data-id"),a=Swal.mixin({customClass:{confirmButton:"btn btn-success",cancelButton:"btn btn-danger mr-2"},buttonsStyling:!1}),i(e).then((function(i){if(i.data){if(1==i.data.is_delete)return a.fire({title:"Không tìm thấy người dùng",icon:"error",showCancelButton:!1,confirmButtonText:"Đóng",timer:3e3});a.fire({title:"Bạn có muốn xoá tài khoản "+i.data.name,icon:"warning",showCancelButton:!0,confirmButtonText:"Đồng ý",cancelButtonText:"Hủy",reverseButtons:!0}).then((function(a){if(a.isConfirmed){var i=t+"/"+e;$.ajax({url:i,method:"delete"}).done((function(t){t&&(Swal.fire({icon:"success",title:t.message,showConfirmButton:!1,timer:1500}),n())})).fail((function(t){return t.responseJSON}))}}))}else a.fire({title:"Không tìm thấy người dùng",icon:"error",showCancelButton:!1,confirmButtonText:"Đóng",timer:3e3})}))})),$(".btn-search-user").click((function(t){t.preventDefault();var e=$("#searchUser"),a=new FormData(e[0]),i=a.get("name"),s=a.get("email"),r=a.get("group"),o=a.get("status");""==i&&""==s&&""==r&&""==o||n()})),$(".btn-reset-search-user").click((function(){a($("#searchUser")),n()})),$(".pagination-container").click(".page-link",(function(n){$(n.target).data("link")&&function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,a=$("#lstUsers");$.ajax({url:n,method:"get",beforeSend:function(){a.html('\n                <div class="loading-table">\n                  <div class="spinner-border text-dark" role="status"></div>\n                </div>')}}).done((function(t){t&&(a.html(t.data),e(t.meta))})).fail((function(t){return t.responseJSON}))}($(n.target).data("link"))}))}))})();